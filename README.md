# PSD Tool for AE

After Effects 2026向けの、PSDレイヤー表示制御用拡張機能です。

読み込んだPSDファイルのレイヤー構造をツリー表示し、チェックボックスやラジオボタンで表示/非表示を切り替え、その状態をコンポジションのキーフレームとして即座に反映します。

簡易的な口パク・目パチのアニメーション制作や、差分管理に役立ちます。

## PSDファイルの仕様
基本的には[立ち絵支援ツール PSDTool様にて解説されている仕様](https://bl.oov.ch/2016/08/psdtool.html)に準拠しています。

フォルダ・レイヤー構造をそのままAfter Effectsのコンポジション階層にマッピングします。

フォルダ・レイヤー名の先頭に特定の記号を付与することで、表示切替の動作を変更できます。
- `*` (アスタリスク): ラジオボタンとして動作。同一階層内で排他的に選択されます。
- `!` (感嘆符): ロック (常時表示) として動作。常に表示され、操作できません。

## 機能

- **テーマ同期**: After EffectsのUIの明るさ設定に合わせて、パネルの色が自動的に変わります。
- **階層ツリー表示**: フォルダ・レイヤー構造を子孫まで含めて再帰的にツリー表示します。
- **ツリーの一括展開/折り畳み**:
    - `Alt` キーを押しながら `▶` / `▼` をクリックすると、配下のフォルダを一括で展開/折り畳み。
    - 画面上部の「すべてのフォルダを畳む」ボタンで全フォルダを折り畳むことができる。
- **表示切替**
    - **チェックボックス**: 通常のレイヤー。
    - **ラジオボタン**: レイヤー名またはフォルダ名の先頭が `*` の場合、同一階層内で排他的に選択されます。
    - **ロック (常時表示)**: レイヤー名またはフォルダ名の先頭が `!` の場合、常に表示されます（操作不可）。
- **キーフレーム操作**
    - **取得**: 現在位置のキーフレームを子孫レイヤも含めて全て取得し記録します。
    - **移動**: 記録したキーフレームを任意の場所へ移動させることができます。
- **プリセット**
	- **保存/呼び出し**: レイヤーの表示状態をプリセットとして保存・呼び出しできます。
    - **インポート/エクスポート**: プリセットをJSON形式で保存・読み込みできます。

## 使い方
1. PSDファイルをAfter Effectsのプロジェクトパネルにドラッグ＆ドロップして読み込みます。必ず「**コンポジションとして読み込み**」を選択してください。

2. メニューバーの **ウィンドウ > 拡張機能 > PSD Tool AE** を選択してパネルを開きます。

3. 「再読み込み」ボタンをクリックして、PSDファイルの内容をパネルに反映させます。

4. ツリー上のチェックボックスやラジオボタンを操作して、レイヤーの表示/非表示を切り替えます。変更は即座にコンポジションに反映されます。

5. 「キーフレーム操作」欄の「取得」ボタンをクリックして、現在位置のキーフレームを子孫レイヤも含めて全て取得します。

6. 「キーフレーム操作」欄の「移動」ボタンをクリックして、記録したキーフレームを任意の場所へ移動させることができます。

7. 表示状態のプリセットを保存したい場合は、「Presets」欄の「+」ボタンをクリックします。プリセット名を入力するダイアログが表示されるので、任意の名前を入力します。保存したプリセットはリストから選択して呼び出すことができます。

8. プリセットのインポート/エクスポートは、「Presets」欄の「In」/「Ex」ボタンから行えます。エクスポートされたJSONファイルは、他のプロジェクトと共有することができます。

## 動作環境

- Adobe After Effects 2026 (またはそれ以降のCEP 9.0対応バージョン)
- Windows / macOS

## インストール方法 (開発者モード / 手動インストール)

ZXPインストーラーを使用しない、未署名拡張機能としてのインストール手順です。

### 1. デバッグモードの有効化
未署名の拡張機能を読み込むために、レジストリ(Windows)またはターミナル(macOS)の設定が必要です。

#### Windows (PowerShell)
以下のコマンドをPowerShellで実行し、Adobe CEPのデバッグモードを有効にします。
```powershell
$versions = 10..20
foreach ($v in $versions) {
    reg add "HKCU\Software\Adobe\CSXS.$v" /v PlayerDebugMode /t REG_SZ /d 1 /f
}
```

#### macOS (Terminal)
```bash
defaults write com.adobe.CSXS.10 PlayerDebugMode 1
defaults write com.adobe.CSXS.11 PlayerDebugMode 1
# ...必要に応じてバージョン番号を変えて実行
```

### 2. 拡張機能フォルダへの配置

本リポジトリのデータを、AdobeのExtensionフォルダに配置します。

#### Windows
`C:\Users\<ユーザー名>\AppData\Roaming\Adobe\CEP\extensions\`  
上記のフォルダの中に `psdtool_ae` という名前でフォルダを作成し、リポジトリの中身をすべてコピーしてください。

(コマンドでシンボリックリンクを作成する場合)
```powershell
New-Item -ItemType Directory -Force -Path "$env:APPDATA\Adobe\CEP\extensions"
New-Item -ItemType Junction -Path "$env:APPDATA\Adobe\CEP\extensions\psdtool_ae" -Value "ダウンロードしたフォルダのフルパス"
```

#### macOS
`/Library/Application Support/Adobe/CEP/extensions/`  
または  
`~/Library/Application Support/Adobe/CEP/extensions/`

上記のフォルダの中にコピーしてください。

### 3. After Effectsの起動
After Effectsを起動し、メニューバーの **ウィンドウ > 拡張機能 > PSD Tool AE** を選択してパネルを開きます。

## ライセンス

全部AIが作ったのでパブリックドメインとします。ご自由にお使いください。